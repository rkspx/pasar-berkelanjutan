{% extends 'base.html' %}

{% block title %}Sign Up - Pasar Berkelanjutan Jakarta{% endblock %}

{% block head %}
<style>
    .auth-container {
        max-width: 500px;
        margin: 0 auto;
        padding: var(--spacing-xl);
        background-color: var(--white);
        border-radius: var(--border-radius-md);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .auth-header {
        text-align: center;
        margin-bottom: var(--spacing-xl);
    }
    
    .auth-header h1 {
        margin-bottom: var(--spacing-sm);
    }
    
    .auth-form .form-group {
        margin-bottom: var(--spacing-lg);
    }
    
    .auth-form label {
        display: block;
        margin-bottom: var(--spacing-xs);
        font-weight: 500;
    }
    
    .auth-form input {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--border-light);
        border-radius: var(--border-radius-md);
        font-size: 1rem;
    }
    
    .auth-form input:focus {
        border-color: var(--primary-green);
        outline: none;
    }
    
    .auth-form .form-row {
        display: flex;
        gap: var(--spacing-md);
    }
    
    .auth-form .form-row .form-group {
        flex: 1;
    }
    
    .auth-form .terms {
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-lg);
    }
    
    .auth-form .terms input {
        width: auto;
        margin-top: 5px;
    }
    
    .auth-divider {
        display: flex;
        align-items: center;
        margin: var(--spacing-lg) 0;
        color: var(--text-light);
    }
    
    .auth-divider::before,
    .auth-divider::after {
        content: "";
        flex: 1;
        height: 1px;
        background-color: var(--border-light);
    }
    
    .auth-divider span {
        padding: 0 var(--spacing-sm);
    }
    
    .social-login {
        display: flex;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }
    
    .social-login-btn {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        border: 1px solid var(--border-light);
        border-radius: var(--border-radius-md);
        background-color: var(--white);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .social-login-btn:hover {
        background-color: var(--off-white);
    }
    
    .auth-footer {
        text-align: center;
        margin-top: var(--spacing-lg);
        color: var(--text-light);
    }
    
    .password-requirements {
        font-size: 0.875rem;
        color: var(--text-light);
        margin-top: var(--spacing-xs);
    }
    
    .password-requirements ul {
        list-style: disc;
        padding-left: var(--spacing-lg);
        margin-top: var(--spacing-xs);
    }
</style>
{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="auth-container">
            <div class="auth-header">
                <h1>Create Account</h1>
                <p>Join the sustainable marketplace community</p>
            </div>
            
            <form class="auth-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="first-name">First Name</label>
                        <input type="text" id="first-name" name="first-name" placeholder="Enter your first name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="last-name">Last Name</label>
                        <input type="text" id="last-name" name="last-name" placeholder="Enter your last name" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Create a password" required>
                    <div class="password-requirements">
                        Password must:
                        <ul>
                            <li>Be at least 8 characters long</li>
                            <li>Include at least one uppercase letter</li>
                            <li>Include at least one number</li>
                            <li>Include at least one special character</li>
                        </ul>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="confirm-password">Confirm Password</label>
                    <input type="password" id="confirm-password" name="confirm-password" placeholder="Confirm your password" required>
                </div>
                
                <label class="terms">
                    <input type="checkbox" name="terms" required>
                    <span>I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>. I understand that my personal data will be processed as described in the Privacy Policy.</span>
                </label>
                
                <button type="submit" class="btn btn-primary w-100 mt-3">Create Account</button>
            </form>
            
            <div class="auth-divider">
                <span>or</span>
            </div>
            
            <div class="social-login">
                <button class="social-login-btn">
                    <i data-lucide="google" width="20" height="20"></i>
                    Google
                </button>
                <button class="social-login-btn">
                    <i data-lucide="facebook" width="20" height="20"></i>
                    Facebook
                </button>
            </div>
            
            <div class="auth-footer">
                <p>Already have an account? <a href="/signin">Sign In</a></p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.auth-form');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm-password');
        
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Check if passwords match
            if (password.value !== confirmPassword.value) {
                showNotification('Passwords do not match!', 'error');
                return;
            }
            
            // Get form data
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            // Create username from first and last name
            const username = `${firstName.toLowerCase()}_${lastName.toLowerCase()}`;
            
            // Prepare user data
            const userData = {
                username: username,
                email: email,
                password: password.value,
                is_seller: false // Default to regular user, can be changed later
            };
            
            // Show loading state
            const submitButton = form.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Creating account...';
            submitButton.disabled = true;
            
            try {
                // Call the API register function
                const result = await window.api.registerUser(userData);
                
                // After successful registration, log the user in
                await window.api.loginUser(email, password.value);
                
                // Show success message
                showNotification('Account created successfully!');
                
                // Redirect to home page
                window.location.href = '/';
            } catch (error) {
                // Show error message
                showNotification(error.message || 'Registration failed. Please try again.', 'error');
                
                // Reset button
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        });
        
        // Password validation
        password.addEventListener('input', function() {
            const value = this.value;
            const requirements = [
                value.length >= 8,
                /[A-Z]/.test(value),
                /[0-9]/.test(value),
                /[^A-Za-z0-9]/.test(value)
            ];
            
            const requirementItems = document.querySelectorAll('.password-requirements ul li');
            
            requirements.forEach((met, index) => {
                if (requirementItems[index]) {
                    requirementItems[index].style.color = met ? 'green' : '';
                }
            });
        });
    });
    
    // Show notification function (copied from main.js for consistency)
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.classList.add('active');
        }, 10);
        
        // Remove after delay
        setTimeout(() => {
            notification.classList.remove('active');
            
            // Remove from DOM after animation completes
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 3000);
    }
</script>
{% endblock %}